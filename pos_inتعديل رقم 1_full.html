<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙƒØ§Ø´ÙŠØ± + ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
  <style>
    body { background:#f3f3f3; }
    .category-btn{cursor:pointer}
    .product-card{cursor:pointer;transition:.2s}
    .product-card:hover{transform:scale(1.05)}
    .bill-box{background:white;border-radius:12px;padding:15px;height:100%}
    .order-item{border-bottom:1px dashed #ccc;padding:6px 0}
    .category-active{background:#0d6efd!important;color:#fff!important}
    #loginPage{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#eee;z-index:10}
    #mainPOS{display:none}
  </style>
</head>
<body>

<!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginPage">
  <div class="card shadow p-4" style="width:350px;">
    <h4 class="text-center mb-3">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h4>
    <input id="user" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
    <input id="pass" class="form-control mb-3" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" type="password">
    <button id="loginBtn" class="btn btn-primary w-100">Ø¯Ø®ÙˆÙ„</button>
  </div>
</div>

<!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙƒØ§Ø´ÙŠØ± -->
<div id="mainPOS">
<div class="container-fluid p-2">
  <div class="row g-2">

    <!-- Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
    <div class="col-12 col-md-4">
      <div class="bill-box shadow-sm">
        <h4 class="mb-3">ğŸ§¾ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h4>
        <div id="orderList"></div>
        <hr/>
        <div class="d-flex justify-content-between fw-bold fs-5">
          <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span><span id="total">0</span> Ø±.Ø¹
        </div>
        <button id="finishBtn" class="btn btn-success w-100 mt-2">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨</button>
        <button id="printBtn" class="btn btn-outline-dark w-100 mt-2">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
      </div>
    </div>

    <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
    <div class="col-12 col-md-8">

      <!-- Ø¨Ø­Ø« -->
      <input id="search" class="form-control mb-2" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬" />

      <!-- Ø§Ù„ÙØ¦Ø§Øª -->
      <div class="d-flex gap-2 flex-wrap mb-2" id="categoryContainer"></div>

      <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
      <div class="row g-2" id="productsContainer"></div>

    </div>
  </div>
</div>
</div>

<script>
// --- Data (ÙŠÙ…ÙƒÙ† Ù†Ù‚Ù„Ù‡Ø§ Ù„Ù…Ù„Ù Ø®Ø§Ø±Ø¬ÙŠ Ù„Ø§Ø­Ù‚Ø§Ù‹)
const categories = ["ÙØ±ÙŠØ´", "ÙƒÙˆÙƒØªÙŠÙ„", "Ø¢ÙŠØ³ ÙƒØ±ÙŠÙ…", "ÙƒØ§Ù†Ø²", "Ø¥Ø¶Ø§ÙØ§Øª"];
const products = [
  {id:1, name:"Ù…Ø§Ù†Ø¬Ùˆ", base:1.0, cat:"ÙØ±ÙŠØ´"},
  {id:2, name:"Ø¬ÙˆØ§ÙØ©", base:1.0, cat:"ÙØ±ÙŠØ´"},
  {id:3, name:"ÙØ±Ø§ÙˆÙ„Ø©", base:1.2, cat:"ÙƒÙˆÙƒØªÙŠÙ„"},
  {id:4, name:"Ù…ÙˆØ² Ø¨Ø§Ù„Ù„Ø¨Ù†", base:1.3, cat:"ÙƒÙˆÙƒØªÙŠÙ„"},
  {id:5, name:"ÙØ§Ù†ÙŠÙ„Ø§", base:0.7, cat:"Ø¢ÙŠØ³ ÙƒØ±ÙŠÙ…"},
  {id:6, name:"Ø´ÙŠÙƒÙˆÙ„Ø§ØªØ©", base:0.7, cat:"Ø¢ÙŠØ³ ÙƒØ±ÙŠÙ…"},
  {id:7, name:"Ø¨ÙŠØ¨Ø³ÙŠ", base:0.5, cat:"ÙƒØ§Ù†Ø²"},
  {id:8, name:"Ø³ÙÙ†", base:0.5, cat:"ÙƒØ§Ù†Ø²"}
];

// Ø§Ù„Ø£Ø­Ø¬Ø§Ù…
const sizes = {
  "ØµØºÙŠØ±": 1,
  "ÙˆØ³Ø·": 1.3,
  "ÙƒØ¨ÙŠØ±": 1.6,
  "Ù„ØªØ±": 2,
  "Ù„ØªØ± ÙˆÙ†Øµ": 2.5
};

let currentCategory = "ÙØ±ÙŠØ´";
let order = [];

// --- Helper functions (Ù†Ø¹Ø±Ù‘ÙÙ‡Ø§ Ø¹Ù„Ù‰ window Ù„Ø¶Ù…Ø§Ù† Ø£Ù†Ù‡Ø§ Ù…ØªØ§Ø­Ø© ÙƒØ³ÙŠÙ†Ø§Ø±ÙŠÙˆ inline handlers Ø³Ø§Ø¨Ù‚)
window.renderCategories = function(){
  const box = document.getElementById("categoryContainer");
  box.innerHTML = "";
  categories.forEach(cat => {
    const btn = document.createElement("div");
    btn.className = "px-3 py-2 border rounded category-btn";
    if (cat === currentCategory) btn.classList.add("category-active");
    btn.textContent = cat;
    btn.addEventListener('click', () => { currentCategory = cat; renderCategories(); renderProducts(); });
    box.appendChild(btn);
  });
};

window.renderProducts = function(){
  const box = document.getElementById("productsContainer");
  box.innerHTML = "";
  const q = (document.getElementById("search").value || "").trim().toLowerCase();
  const filtered = products.filter(p => p.cat === currentCategory && p.name.toLowerCase().includes(q));

  filtered.forEach(p => {
    const div = document.createElement("div");
    div.className = "col-6 col-md-4";
    // Ù†Ø³ØªØ®Ø¯Ù… data-id Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† onclick inline Ù„ØªØ¬Ù†Ù‘Ø¨ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù€ scope
    div.innerHTML = `
      <div class="product-card p-2 text-center bg-white shadow-sm rounded" data-id="${p.id}">
        <h6>${p.name}</h6>
        <small>Ù…Ù† ${p.base.toFixed(3)} Ø±.Ø¹</small>
      </div>`;
    box.appendChild(div);
  });

  // Ø§Ø±Ø¨Ø· Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†Ù‚Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
  box.querySelectorAll('.product-card').forEach(el => {
    el.addEventListener('click', () => {
      const id = Number(el.getAttribute('data-id'));
      window.chooseSize(id);
    });
  });
};

// Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ø¬Ù… (Ù…ØµØ­Ù‘Ø­: Ø§Ø³ØªØ®Ø¯Ù… \n Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† newline literal)
window.chooseSize = function(id){
  const p = products.find(x => x.id === id);
  if(!p) return;
  let msg = "Ø§Ø®ØªØ± Ø§Ù„Ø­Ø¬Ù…:\n";
  Object.keys(sizes).forEach(s => { msg += s + "\n"; });
  const chosen = prompt(msg, "ÙˆØ³Ø·");
  if(!chosen) return; // user cancelled
  if(!sizes.hasOwnProperty(chosen)){
    alert('Ø§Ù„Ø­Ø¬Ù… ØºÙŠØ± ØµØ§Ù„Ø­');
    return;
  }
  const finalPrice = (p.base * sizes[chosen]);
  order.push({ name: `${p.name} (${chosen})`, price: finalPrice });
  renderOrder();
};

window.renderOrder = function(){
  const box = document.getElementById("orderList");
  box.innerHTML = "";
  let total = 0;
  order.forEach((item, i) => {
    total += item.price;
    const row = document.createElement("div");
    row.className = "order-item d-flex justify-content-between align-items-center";
    row.innerHTML = `<span>${item.name}</span><span>${item.price.toFixed(3)} Ø±.Ø¹ <button class='btn btn-sm btn-danger ms-2' data-i='${i}'>x</button></span>`;
    box.appendChild(row);
  });
  // Ø±Ø¨Ø· Ø­Ø¯Ø« Ø§Ù„Ø­Ø°Ù
  box.querySelectorAll('button[data-i]').forEach(b => b.addEventListener('click', (e) => {
    const idx = Number(b.getAttribute('data-i'));
    window.removeItem(idx);
  }));

  document.getElementById("total").textContent = total.toFixed(3);
};

window.removeItem = function(i){
  if(i < 0 || i >= order.length) return;
  order.splice(i, 1);
  renderOrder();
};

window.finishOrder = function(){
  if(order.length === 0) return alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ±");
  alert("âœ” ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨");
  order = [];
  renderOrder();
};

window.printBill = function(){
  // Ø§ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ø·Ø¨Ø¹ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
  const w = window.open('', '_blank');
  if(!w){ alert('Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù…Ø±ÙÙˆØ¶Ø© Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…ØªØµÙØ­ (Ù…Ù†Ø¹ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©).'); return; }
  let html = `<!doctype html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><title>ÙØ§ØªÙˆØ±Ø©</title><style>body{font-family:Arial, sans-serif;direction:rtl}</style></head><body>`;
  html += `<h3>ÙØ§ØªÙˆØ±Ø©</h3><div>`;
  order.forEach(i => html += `<div>${i.name} - ${i.price.toFixed(3)} Ø±.Ø¹</div>`);
  html += `</div><hr><h4>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${document.getElementById("total").textContent} Ø±.Ø¹</h4>`;
  html += `</body></html>`;
  w.document.write(html);
  w.document.close();
  w.focus();
  // Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù„Ø£Ù† Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª ØªØ­ØªØ§Ø¬ ÙˆÙ‚Øª Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©
  setTimeout(() => { w.print(); w.close(); }, 250);
};

// --- Login handling: Ù†Ø±Ø¨Ø· Ø§Ù„Ø­Ø¯Ø« Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€ DOM Ù„Ø¶Ù…Ø§Ù† Ø£Ù† Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ù…Ø¹Ø±ÙØ©
function initApp(){
  // Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙˆØ§Ù„Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØ§Ù„Ø¨Ø­Ø«
  document.getElementById('loginBtn').addEventListener('click', function(){
    const u = document.getElementById('user').value.trim();
    const p = document.getElementById('pass').value;
    if(u === 'admin' && p === '1234'){
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('mainPOS').style.display = 'block';
      // Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ØŒ Ø§Ø±Ø³Ù… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
      renderCategories();
      renderProducts();
    } else {
      alert('Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
    }
  });

  document.getElementById('finishBtn').addEventListener('click', finishOrder);
  document.getElementById('printBtn').addEventListener('click', printBill);
  document.getElementById('search').addEventListener('input', renderProducts);
}

// Ù†Ù†ØªØ¸Ø± DOMContentLoaded
if (document.readyState === 'loading'){
  document.addEventListener('DOMContentLoaded', initApp);
} else {
  initApp();
}

</script>

</body>
</html>
